---
import Image from '~/components/template/common/Image.astro';
import TopicBadge from '~/components/ds/atoms/TopicBadge.astro';
import { getPermalink } from '~/utils/permalinks';
import { getFormattedDate } from '~/utils/utils';
import type { Post } from '~/types';

interface Props {
  posts: Post[];
}

const { posts } = Astro.props;

// Ensure we have at least 1 post, ideally 3
const mainPost = posts[0];
const subPosts = posts.slice(1, 3);
---

<div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
  {/* Main Lead Story (Left, 8 cols) */}
  {mainPost && (
    <div class="lg:col-span-8 group relative">
      <a href={getPermalink(mainPost.permalink, 'post')} class="block h-full relative overflow-hidden rounded-xl shadow-md">
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent z-10 transition-opacity opacity-80 group-hover:opacity-90"></div>
        
        {mainPost.image ? (
            typeof mainPost.image === 'string' ? (
                <img 
                  src={mainPost.image as string} 
                  alt={mainPost.title} 
                  class="w-full h-full object-cover absolute inset-0" 
                  loading="eager"
                  fetchpriority="high"
                />
            ) : (
                <Image 
                  src={mainPost.image} 
                  alt={mainPost.title} 
                  width={1200} 
                  height={800} 
                  class="w-full h-full object-cover absolute inset-0"
                  loading="eager"
                  fetchpriority="high"
                  sizes="(max-width: 1024px) 100vw, 800px"
                />
            )
        ) : (
            <div class="w-full h-full bg-surface-highlight"></div>
        )}

        <div class="absolute bottom-0 left-0 p-6 md:p-8 z-20 max-w-3xl">
          {mainPost.category && (
            <TopicBadge topic={mainPost.category.title} class="mb-3 border-none bg-blue-600/90 text-white hover:bg-blue-600" />
          )}
          <h2 class="text-3xl md:text-5xl font-bold font-heading text-white leading-tight tracking-tight mb-4 drop-shadow-sm">
            {mainPost.title}
          </h2>
          <p class="text-lg text-gray-200 line-clamp-2 md:line-clamp-3 mb-4 hidden md:block">
            {mainPost.excerpt}
          </p>
          <div class="text-sm font-medium text-gray-300">
             {mainPost.author || 'Equipo Editorial'} Â· {getFormattedDate(mainPost.publishDate)}
          </div>
        </div>
      </a>
    </div>
  )}

  {/* Sub Leads (Right, 4 cols, Stacked) */}
  <div class="lg:col-span-4 flex flex-col gap-8">
    {subPosts.map((post) => (
      <a href={getPermalink(post.permalink, 'post')} class="flex-1 group relative rounded-lg overflow-hidden shadow-sm bg-surface-base border border-border-subtle flex flex-col">
        <div class="h-48 overflow-hidden relative">
            {post.image ? (
                typeof post.image === 'string' ? (
                <img src={post.image as string} alt={post.title} class="w-full h-full object-cover" />
                ) : (
                <Image src={post.image} alt={post.title} width={600} height={400} class="w-full h-full object-cover" />
                )
            ) : (
                <div class="w-full h-full bg-surface-highlight"></div>
            )}
        </div>
        <div class="p-5 flex-1 flex flex-col justify-center">
            {post.category && (
                <span class="text-xs font-bold uppercase tracking-wider text-action-primary mb-2">
                    {post.category.title}
                </span>
            )}
            <h3 class="text-xl font-bold text-text-body font-heading leading-tight group-hover:text-action-primary transition-colors">
                {post.title}
            </h3>
        </div>
      </a>
    ))}
  </div>
</div>
