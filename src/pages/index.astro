---
import BaseLayout from '~/layouts/BaseLayout.astro';
import Hero from '~/components/template/widgets/Hero.astro';
import Features from '~/components/template/widgets/Features.astro';
import BlogLatestPosts from '~/components/template/widgets/BlogLatestPosts.astro';
import Stats from '~/components/template/widgets/Stats.astro';
import Content from '~/components/template/widgets/Content.astro';

import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// 1. Featured (Hero)
const featuredPost = sortedPosts.find(p => p.data.featured) || sortedPosts[0];

// 2. Metadata
const metadata = {
  title: 'Noticiencias - Ciencia global, en español.',
  ignoreTitleTemplate: true,
};
---

<BaseLayout metadata={metadata}>
  
  <!-- Hero Widget -->
  <Hero
    actions={[
      {
        variant: 'primary',
        text: 'Leer más',
        href: featuredPost.data.permalink || `/posts/${featuredPost.slug}`,
        icon: 'tabler:arrow-right',
      },
    ]}
    image={{ src: featuredPost.data.image || '~/assets/images/hero.jpg', alt: featuredPost.data.image_alt || 'Noticiencias' }}
  >
    <fragment slot="title">
      {featuredPost.data.title}
    </fragment>

    <fragment slot="subtitle">
      <span class="hidden sm:inline">
          {featuredPost.data.excerpt}
      </span>
      <div class="mt-4 text-sm font-medium text-muted">
         Por {featuredPost.data.author} · {featuredPost.data.date.toLocaleDateString()}
      </div>
    </fragment>
  </Hero>

  <!-- Latest Posts Widget -->
  <BlogLatestPosts
    title="Lo último en Noticiencias"
    information={`Explora nuestras últimas publicaciones sobre ciencia, salud y tecnología.`}
    count={6}
  />

  <!-- Categories (Features Widget) -->
  <Features
    id="features"
    tagline="Explora"
    title="Nuestras Secciones"
    subtitle="Ciencia explicada para todos."
    items={[
      {
        title: 'Editorial',
        description: 'Análisis y opinión sobre el mundo de la ciencia.',
        icon: 'tabler:news',
        callToAction: { text: 'Ver sección', href: '/categories/editorial/' },
      },
      {
        title: 'Salud',
        description: 'Medicina, bienestar y avances clínicos.',
        icon: 'tabler:heart-rate-monitor',
        callToAction: { text: 'Ver sección', href: '/categories/salud/' },
      },
      {
        title: 'Ciencia',
        description: 'Descubrimientos fundamentales y naturaleza.',
        icon: 'tabler:flask',
        callToAction: { text: 'Ver sección', href: '/categories/ciencia/' },
      },
      {
        title: 'Tecnología',
        description: 'Innovación, IA y el futuro digital.',
        icon: 'tabler:device-laptop',
        callToAction: { text: 'Ver sección', href: '/categories/tecnologia/' },
      },
    ]}
  />

  <!-- Stats Widget -->
  <Stats
    stats={[
      { title: 'Artículos', amount: allPosts.length.toString() },
      { title: 'Lectores', amount: '580M' }, // Placeholder based on mission
      { title: 'Confianza', amount: '100%' },
    ]}
  />

</BaseLayout>
