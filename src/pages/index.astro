---
import BaseLayout from '~/layouts/BaseLayout.astro';
import HeroGrid from '~/components/ds/organisms/HeroGrid.astro';
import Grid from '~/components/template/blog/Grid.astro';
import Features from '~/components/template/widgets/Features.astro';
import Stats from '~/components/template/widgets/Stats.astro';
import { findLatestPosts } from '~/utils/blog';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const count = 7;
const latestPosts = await findLatestPosts({ count });
const heroPosts = latestPosts.slice(0, 3);
const morePosts = latestPosts.slice(3);

const metadata = {
  title: 'Noticiencias - Ciencia global, en español.',
  ignoreTitleTemplate: true,
};
---

<BaseLayout metadata={metadata}>
  
  <div class="container mx-auto px-4 py-8">
     {/* Hero Grid Section */}
     <HeroGrid posts={heroPosts} />

     {/* Latest News Section */}
     <div class="mb-12">
        <div class="flex items-center justify-between mb-6 border-b border-gray-200 dark:border-gray-700 pb-2">
            <h2 class="text-2xl font-bold font-heading text-text-body">
                Lo último
            </h2>
            <a href="/blog" class="text-sm font-medium text-action-primary hover:underline">
                Ver todo el archivo &raquo;
            </a>
        </div>
        <Grid posts={morePosts} />
     </div>
  </div>

  <!-- Categories (Features Widget) -->
  <Features
    id="features"
    tagline="Explora"
    title="Nuestras Secciones"
    subtitle="Ciencia explicada para todos."
    items={[
      {
        title: 'Editorial',
        description: 'Análisis y opinión sobre el mundo de la ciencia.',
        icon: 'tabler:news',
        callToAction: { text: 'Ver sección', href: '/categorias/editorial/' },
      },
      {
        title: 'Salud',
        description: 'Medicina, bienestar y avances clínicos.',
        icon: 'tabler:heart-rate-monitor',
        callToAction: { text: 'Ver sección', href: '/categorias/salud/' },
      },
      {
        title: 'Ciencia',
        description: 'Descubrimientos fundamentales y naturaleza.',
        icon: 'tabler:flask',
        callToAction: { text: 'Ver sección', href: '/categorias/ciencia/' },
      },
      {
        title: 'Tecnología',
        description: 'Innovación, IA y el futuro digital.',
        icon: 'tabler:device-laptop',
        callToAction: { text: 'Ver sección', href: '/categorias/tecnologia/' },
      },
    ]}
  />

  <!-- Stats Widget -->
  <Stats
    stats={[
      { title: 'Artículos', amount: allPosts.length.toString() },
      { title: 'Lectores', amount: '580M' }, // Placeholder based on mission
      { title: 'Confianza', amount: '100%' },
    ]}
  />

</BaseLayout>
